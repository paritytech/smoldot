<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Noise protocol libp2p layer."><meta name="keywords" content="rust, rustlang, rust-lang, noise"><title>smoldot::libp2p::connection::noise - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module noise</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../../../index.html">smoldot</a>::<wbr><a href="../../index.html">libp2p</a>::<wbr><a href="../index.html">connection</a>::<wbr><a class="mod" href="#">noise</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../../src/smoldot/libp2p/connection/noise.rs.html#18-975">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Noise protocol libp2p layer.</p>
<p>The <a href="https://noiseprotocol.org/">noise protocol</a> is a standard framework for building
cryptographic protocols. Libp2p uses the noise protocol to provide an encryption layer on
top of which data is exchanged.</p>
<h2 id="protocol-details"><a href="#protocol-details">Protocol details</a></h2>
<p>Libp2p uses <a href="https://noiseexplorer.com/patterns/XX/">the XX pattern</a>. The handshake consists
of three packets:</p>
<ul>
<li>The initiator generates an ephemeral key pair and sends the public key to the responder.</li>
<li>The responder generates its own ephemeral key pair and sends the public key to the
initiator. Afterwards, the responder derives a shared secret and uses it to encrypt all
further communications. Now encrypted, the responder also sends back its static noise public
key (represented with the <a href="struct.NoiseKey.html" title="NoiseKey"><code>NoiseKey</code></a> type of this module), its libp2p public key, and a
signature of the static noise public key made using its libp2p private key.</li>
<li>The initiator, after having received the ephemeral key from the remote, derives the same
shared secret. It sends its own static noise public key, libp2p public key, and signature.</li>
</ul>
<p>After these three packets, the initiator and responder derive another shared secret using
both the static and ephemeral keys, which is then used to encrypt communications. Note that
the libp2p key isn’t used in the key derivation.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>While this is out of scope of this module, the noise protocol must typically first be
negotiated using the <em>multistream-select</em> protocol. The name of the protocol is given by
the <a href="constant.PROTOCOL_NAME.html" title="PROTOCOL_NAME"><code>PROTOCOL_NAME</code></a> constant.</p>
<p>In order to use noise on top of a connection which has agreed to use noise, create a
<a href="struct.HandshakeInProgress.html" title="HandshakeInProgress"><code>HandshakeInProgress</code></a>, passing a <a href="struct.NoiseKey.html" title="NoiseKey"><code>NoiseKey</code></a>. This <a href="struct.NoiseKey.html" title="NoiseKey"><code>NoiseKey</code></a> is typically generated at
startup and doesn’t need to be persisted after a restart.</p>
<p>Use <a href="struct.HandshakeInProgress.html#method.read_write" title="HandshakeInProgress::read_write"><code>HandshakeInProgress::read_write</code></a> when data is received from the wire or when the remote
is ready to receive more data. At every call, a <a href="enum.NoiseHandshake.html" title="NoiseHandshake"><code>NoiseHandshake</code></a> is returned, potentially
indicating the end of the handshake.</p>
<p>If the handshake is finished, a <a href="enum.NoiseHandshake.html#variant.Success" title="NoiseHandshake::Success"><code>NoiseHandshake::Success</code></a> is returned, containing the
<a href="../../peer_id/struct.PeerId.html" title="PeerId"><code>PeerId</code></a> of the remote, which is known to be legitimate, and a <a href="struct.Noise.html" title="Noise"><code>Noise</code></a> object through
which all further communications should go through.</p>
<p>Use <a href="struct.Noise.html#method.encrypt" title="Noise::encrypt"><code>Noise::encrypt</code></a> in order to send out data to the remote, and
<a href="struct.Noise.html#method.inject_inbound_data" title="Noise::inject_inbound_data"><code>Noise::inject_inbound_data</code></a> when data is received.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CipherError.html" title="smoldot::libp2p::connection::noise::CipherError struct">CipherError</a></div><div class="item-right docblock-short">Error while decoding data.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="smoldot::libp2p::connection::noise::Config struct">Config</a></div><div class="item-right docblock-short">Configuration for a Noise handshake.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HandshakeInProgress.html" title="smoldot::libp2p::connection::noise::HandshakeInProgress struct">HandshakeInProgress</a></div><div class="item-right docblock-short">Handshake still in progress. More data needs to be sent or received.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Noise.html" title="smoldot::libp2p::connection::noise::Noise struct">Noise</a></div><div class="item-right docblock-short">State of the noise encryption/decryption cipher.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NoiseKey.html" title="smoldot::libp2p::connection::noise::NoiseKey struct">NoiseKey</a></div><div class="item-right docblock-short">The noise key is the key exchanged during the noise handshake. It is <strong>not</strong> the same as the
libp2p key. The libp2p key is used only to sign the noise public key, while the ECDH is
performed with the noise key.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PayloadDecodeError.html" title="smoldot::libp2p::connection::noise::PayloadDecodeError struct">PayloadDecodeError</a></div><div class="item-right docblock-short">Error while decoding the handshake.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UnsignedNoiseKey.html" title="smoldot::libp2p::connection::noise::UnsignedNoiseKey struct">UnsignedNoiseKey</a></div><div class="item-right docblock-short">Prototype for a <a href="struct.NoiseKey.html" title="NoiseKey"><code>NoiseKey</code></a>.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.HandshakeError.html" title="smoldot::libp2p::connection::noise::HandshakeError enum">HandshakeError</a></div><div class="item-right docblock-short">Potential error during the noise handshake.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.NoiseHandshake.html" title="smoldot::libp2p::connection::noise::NoiseHandshake enum">NoiseHandshake</a></div><div class="item-right docblock-short">State of a Noise handshake.</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PROTOCOL_NAME.html" title="smoldot::libp2p::connection::noise::PROTOCOL_NAME constant">PROTOCOL_NAME</a></div><div class="item-right docblock-short">Name of the protocol, typically used when negotiated it using <em>multistream-select</em>.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>