<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Warp syncing."><meta name="keywords" content="rust, rustlang, rust-lang, warp_sync"><title>smoldot::sync::warp_sync - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../smoldot/index.html"><div class="logo-container"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module warp_sync</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">sync</a>::<wbr><a class="mod" href="#">warp_sync</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/sync/warp_sync.rs.html#18-1556">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Warp syncing.</p>
<p>Warp syncing makes it possible to very quickly reach the currently finalized block of a chain.
No attempt is made at verifying blocks. The algorithm assumes that the currently finalized
block is valid, as the chain is likely bricked if this is not the case.</p>
<h2 id="long-range-attack-vulnerability"><a href="#long-range-attack-vulnerability">Long range attack vulnerability</a></h2>
<p>Warp syncing is particularly vulnerable to what is called long range attacks.</p>
<p>The authorities allowed to finalize blocks can generate multiple proofs of finality for
multiple different blocks of the same height. In other words, they can finalize more than one
chain at a time.</p>
<p>Finalizing multiple chains at the same time is called an equivocation. Client implementations
detect equivocations and report them to the runtime. While this is out of scope of the client,
the runtime then typically provides a mechanism that punishes the validators that have
equivocated.
However, this defense mechanism is flawed in case when a long time passes between the
multiple finality proofs generated by the same validators. Clients cannot hold an unlimited
amount of information in memory, so they might not detect the equivocation, and even if it is
detected, the punishment might not be enforceable because validators have moved all their
funds.</p>
<p>In other words, it is possible for two thirds of the validators that were active at a certain
past block N to collude and decide to finalize a different block N, even when N has been
finalized for the first time several weeks or months in the past. When a client then warp
syncs, it can be tricked to consider this alternative block N as the finalized one.</p>
<p>There is no fool-proof defense against this attack. However, consider the extremely high
investment and high risk for the malicious validators, and the difficulty of pulling off this
attack, it is extremely unlikely to happen in reality.
The aforementioned punishment system is the only defense against this attack, and in order to
be effective, the starting point of the warp syncing shouldn’t be too far in the past. How
far exactly depends on the logic of the runtime of the chain.</p>
<h2 id="overview"><a href="#overview">Overview</a></h2>
<p>The warp syncing algorithm works only if the chain uses Grandpa for its finality.
It consists in the following steps:</p>
<ul>
<li>Downloading a warp sync proof from a source. This proof contains a list of <em>fragments</em>. Each
fragment represents a change in the list of Grandpa authorities, and a list of signatures of
the previous authorities that certify that this change is correct.</li>
<li>Verifying the fragments. Each fragment that is successfully verified progresses towards
towards the head of the chain. Even if one fragment is invalid, all the previously-verified
fragments can still be kept, and the warp syncing can resume from there.</li>
<li>Downloading from a source the runtime code of the final block of the proof.</li>
<li>Performing some runtime calls in order to obtain the current consensus-related parameters
of the chain. This might require obtaining some storage items, in which case they must also
be downloaded from a source.</li>
</ul>
<p>At the end of the syncing, a <a href="../../chain/chain_information/struct.ValidChainInformation.html" title="ValidChainInformation"><code>ValidChainInformation</code></a> corresponding to the head of the chain
is yielded.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>Use the <a href="fn.start_warp_sync.html" title="start_warp_sync()"><code>start_warp_sync()</code></a> function to start a Grandpa warp syncing state machine.</p>
<p>At any given moment, this state machine holds a list of <em>sources</em> that it might use to
download the warp sync proof or the runtime code. Sources must be added and removed by the API
user by calling one of the various <code>add_source</code> and <code>remove_source</code> functions.</p>
<p>Sources are identified through a <a href="struct.SourceId.html" title="SourceId"><code>SourceId</code></a>. Each source has an opaque so-called “user data”
of type <code>TSrc</code> associated to it. The content of this “user data” is at the discretion of the
API user.</p>
<p>Similarly, at any given moment, this state machine holds a list of requests that concern these
sources. Use <a href="struct.InProgressWarpSync.html#method.desired_requests" title="InProgressWarpSync::desired_requests"><code>InProgressWarpSync::desired_requests</code></a> to determine which requests will be
useful to the progress of the warp syncing, then use <a href="struct.InProgressWarpSync.html#method.add_request" title="InProgressWarpSync::add_request"><code>InProgressWarpSync::add_request</code></a> to
update the state machine with a newly-started request.</p>
<p>Use <a href="struct.InProgressWarpSync.html#method.process_one" title="InProgressWarpSync::process_one"><code>InProgressWarpSync::process_one</code></a> in order to run verifications of the payloads that have
previously been downloaded.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.FragmentError"><code>pub use warp_sync::<a class="enum" href="../../finality/grandpa/warp_sync/enum.Error.html" title="enum smoldot::finality::grandpa::warp_sync::Error">Error</a> as FragmentError;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WarpSyncFragment"><code>pub use warp_sync::<a class="struct" href="../../finality/grandpa/warp_sync/struct.WarpSyncFragment.html" title="struct smoldot::finality::grandpa::warp_sync::WarpSyncFragment">WarpSyncFragment</a>;</code></div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BuildChainInformation.html" title="smoldot::sync::warp_sync::BuildChainInformation struct">BuildChainInformation</a></div><div class="item-right docblock-short">Ready to verify the parameters of the chain against the finalized block.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BuildRuntime.html" title="smoldot::sync::warp_sync::BuildRuntime struct">BuildRuntime</a></div><div class="item-right docblock-short">Ready to build the runtime of the finalized chain.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="smoldot::sync::warp_sync::Config struct">Config</a></div><div class="item-right docblock-short">The configuration for <a href="fn.start_warp_sync.html" title="start_warp_sync()"><code>start_warp_sync()</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InProgressWarpSync.html" title="smoldot::sync::warp_sync::InProgressWarpSync struct">InProgressWarpSync</a></div><div class="item-right docblock-short">Warp syncing process now obtaining the chain information.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RequestId.html" title="smoldot::sync::warp_sync::RequestId struct">RequestId</a></div><div class="item-right docblock-short">Identifier for a request in the warp sync state machine.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SourceId.html" title="smoldot::sync::warp_sync::SourceId struct">SourceId</a></div><div class="item-right docblock-short">Identifier for a source in the <a href="enum.WarpSync.html" title="WarpSync"><code>WarpSync</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Success.html" title="smoldot::sync::warp_sync::Success struct">Success</a></div><div class="item-right docblock-short">The result of a successful warp sync.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.VerifyWarpSyncFragment.html" title="smoldot::sync::warp_sync::VerifyWarpSyncFragment struct">VerifyWarpSyncFragment</a></div><div class="item-right docblock-short">Ready to verify a warp sync fragment.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.DesiredRequest.html" title="smoldot::sync::warp_sync::DesiredRequest enum">DesiredRequest</a></div><div class="item-right docblock-short">Information about a request that the warp sync state machine would like to start.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="smoldot::sync::warp_sync::Error enum">Error</a></div><div class="item-right docblock-short">Problem encountered during a call to <a href="fn.start_warp_sync.html" title="start_warp_sync()"><code>start_warp_sync()</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ProcessOne.html" title="smoldot::sync::warp_sync::ProcessOne enum">ProcessOne</a></div><div class="item-right docblock-short">Return value of <a href="struct.InProgressWarpSync.html#method.process_one" title="InProgressWarpSync::process_one"><code>InProgressWarpSync::process_one</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.RequestDetail.html" title="smoldot::sync::warp_sync::RequestDetail enum">RequestDetail</a></div><div class="item-right docblock-short">Information about a request to add to the state machine.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Status.html" title="smoldot::sync::warp_sync::Status enum">Status</a></div><div class="item-right docblock-short">See <a href="struct.InProgressWarpSync.html#method.status" title="InProgressWarpSync::status"><code>InProgressWarpSync::status</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.WarpSync.html" title="smoldot::sync::warp_sync::WarpSync enum">WarpSync</a></div><div class="item-right docblock-short">The warp sync state machine.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.WarpSyncInitError.html" title="smoldot::sync::warp_sync::WarpSyncInitError enum">WarpSyncInitError</a></div><div class="item-right docblock-short">Error potentially returned by <a href="fn.start_warp_sync.html" title="start_warp_sync()"><code>start_warp_sync()</code></a>.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.start_warp_sync.html" title="smoldot::sync::warp_sync::start_warp_sync fn">start_warp_sync</a></div><div class="item-right docblock-short">Initializes the warp sync state machine.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.1 (d5a82bbd2 2023-02-07)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>